{"title":"整一整Hexo","slug":"整一整Hexo","date":"2022-05-11T06:23:33.000Z","updated":"2022-05-11T09:48:45.966Z","comments":true,"path":"api/articles/整一整Hexo.json","photos":[],"link":"","excerpt":"Hexo跑起来了！费劲艰辛，终于让hexo能够免密上传了。记录一下过程留以备用。","covers":null,"content":"<h2 id=\"Hexo跑起来了！\"><a href=\"#Hexo跑起来了！\" class=\"headerlink\" title=\"Hexo跑起来了！\"></a>Hexo跑起来了！</h2><p>费劲艰辛，终于让hexo能够免密上传了。记录一下过程留以备用。</p>\n<span id=\"more\"></span>\n\n<p>[TOC]</p>\n<p>根据我的理解，Hexo就是将你的markdown文档们以及他们的资源打包成静态网站。所以首先你需要一个能够运行静态网站的服务器。然后把Hexo发布的文件夹当根目录，让服务器运行起来就可以了。<br>$$<br>.md -&gt; hexo-&gt;webserver<br>$$</p>\n<blockquote>\n<p>如有个人服务器建议安装宝塔面板，能减少许多操作，看起来更直观。</p>\n</blockquote>\n<h3 id=\"必要环境\"><a href=\"#必要环境\" class=\"headerlink\" title=\"必要环境\"></a>必要环境</h3><ul>\n<li><p>Git——用于将本地生成的网站上传到远程服务器（如果你愿意远程ssh写markdown也可以，就不需要git了）</p>\n</li>\n<li><p>web服务器（这里用nginx）</p>\n</li>\n<li><p>Nodejs——hexo使用nodejs生成网站</p>\n</li>\n<li><p>Hexo——</p>\n</li>\n</ul>\n<p>nginx和Nodejs通过宝塔下好，免去自己安装的苦恼。</p>\n<p>Hexo按照官方下载方法下载好，并初始化网站。</p>\n<blockquote>\n<p>⚠hexo这里遇到问题，Nodejs版本太老需要更新，windows下直接找官网下载msi文件，覆盖旧的Nodejs</p>\n</blockquote>\n<h3 id=\"Git配置\"><a href=\"#Git配置\" class=\"headerlink\" title=\"Git配置\"></a>Git配置</h3><p>本地与服务端都下载git。</p>\n<p>git这里的主要作用是用来上传更新后的网站。</p>\n<h4 id=\"本地Git：\"><a href=\"#本地Git：\" class=\"headerlink\" title=\"本地Git：\"></a>本地Git：</h4><p>新鲜下载的git需要配置一下帐户</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --global user.name <span class=\"string\">&quot;yourname&quot;</span></span><br><span class=\"line\">git config --global user.email youremail@example.com</span><br></pre></td></tr></table></figure>\n\n<p>并且生成公钥以便ssh认证——进行ssh认证之后就不用每次上传都用密码验证了。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -C <span class=\"string\">&quot;youremail@example.com&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>使用bash<code>cat ~/.ssh/id_rsa.pub</code>找到公钥；或者资源管理器<code>C:\\Users\\账户名\\.ssh</code>寻找<code>id_rsa.pub</code>留着备用。</p>\n<blockquote>\n<p>如果你有pub，之前使用过ssl。那可以直接拿来用。</p>\n</blockquote>\n<h4 id=\"服务端Git：\"><a href=\"#服务端Git：\" class=\"headerlink\" title=\"服务端Git：\"></a>服务端Git：</h4><p>安装Git后添加git用户。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd git</span><br><span class=\"line\">passwd git // 设置密码(如果你在新建时设置过了不用再设置)</span><br><span class=\"line\">su git // 切换到git用户</span><br></pre></td></tr></table></figure>\n\n<p>找一个地方做项目的目录，在目录下创建仓库</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /home/git/</span><br><span class=\"line\">//你的网站项目根目录</span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> /blog </span><br><span class=\"line\">//git仓库根目录</span><br><span class=\"line\"><span class=\"built_in\">mkdir</span> repos</span><br><span class=\"line\"><span class=\"built_in\">cd</span> repos</span><br><span class=\"line\">git init --bare blog.git</span><br></pre></td></tr></table></figure>\n\n<p>在.git下创建钩子函数</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> blog.git/hooks</span><br><span class=\"line\">vim post-receive </span><br></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//钩子函数内容</span><br><span class=\"line\">git --work-tree=/home/git/blog --git-dir=/home/git/repos/blog.git checkout -f</span><br></pre></td></tr></table></figure>\n\n<p>添加完毕后</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">chmod</span> +x post-receive</span><br><span class=\"line\"><span class=\"built_in\">exit</span></span><br><span class=\"line\">//添加权限</span><br><span class=\"line\"><span class=\"built_in\">chown</span> -R git:git /home/git/repos/blog.git</span><br></pre></td></tr></table></figure>\n\n<p>测试是否能拉下git仓库</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> git@server_ip:/home/git/repos/blog.git</span><br></pre></td></tr></table></figure>\n\n<p>如果成功则证明没有问题了。</p>\n<h4 id=\"本地与服务端建立ssh信任关系：\"><a href=\"#本地与服务端建立ssh信任关系：\" class=\"headerlink\" title=\"本地与服务端建立ssh信任关系：\"></a>本地与服务端建立ssh信任关系：</h4><p>在本地电脑操作：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//ssh-copy-id命令可以把本地的ssh公钥文件安装到远程主机对应的账户下</span><br><span class=\"line\">ssh-copy-id -i C:/Users/yourname/.ssh/id_rsa.pub git@server_ip</span><br><span class=\"line\">// 测试能否登录</span><br><span class=\"line\">ssh git@server_ip </span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>此时登录应该是不需要密码的！</p>\n</blockquote>\n<h4 id=\"禁用git的shell（为了安全）\"><a href=\"#禁用git的shell（为了安全）\" class=\"headerlink\" title=\"禁用git的shell（为了安全）\"></a>禁用git的shell（为了安全）</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">which</span> git-shell//查看是否安装git-shell</span><br><span class=\"line\">vim /etc/shells//添加上gitshell的路径</span><br><span class=\"line\">//通常为/usr/bin/git-shall</span><br></pre></td></tr></table></figure>\n\n<p>修改<code>/etc/passwd</code>权限</p>\n<p>找到git</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//修改git的shell为git-shell</span><br><span class=\"line\">// 将原来的</span><br><span class=\"line\">git:x:1002:1002:git,,,:/home/git:/bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\">// 修改为</span><br><span class=\"line\">git:x:1002:1002:git,,,:/home/git:/usr/bin/git-shell</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>其他的不要改，只改shell，否则会出错！</p>\n</blockquote>\n<h3 id=\"Hexo发布设置\"><a href=\"#Hexo发布设置\" class=\"headerlink\" title=\"Hexo发布设置\"></a>Hexo发布设置</h3><p>编辑—config.yml的deploy属性</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">deploy:</span></span><br><span class=\"line\">  <span class=\"attr\">type:</span> <span class=\"string\">git</span></span><br><span class=\"line\">  <span class=\"attr\">repo:</span> <span class=\"string\">git@你的ip:/home/git/repos/blog.git</span></span><br><span class=\"line\">  <span class=\"attr\">branch:</span> <span class=\"string\">master</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"在宝塔面板添加网站\"><a href=\"#在宝塔面板添加网站\" class=\"headerlink\" title=\"在宝塔面板添加网站\"></a>在宝塔面板添加网站</h3><p>网站-&gt;php项目-&gt;添加站点</p>\n<p>域名填写你网站的域名。</p>\n<p>注意要把根目录填对！</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/home/git/blog</span><br></pre></td></tr></table></figure>\n\n\n\n<p>参考文章：</p>\n<p><a href=\"https://blog.csdn.net/qq_35561857/article/details/81590953?spm=1001.2101.3001.6650.3&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-3-81590953-blog-124067428.pc_relevant_paycolumn_v3&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-3-81590953-blog-124067428.pc_relevant_paycolumn_v3&amp;utm_relevant_index=6\">带你跳过各种坑，一次性把 Hexo 博客部署到自己的服务器</a></p>\n<p><a href=\"https://blog.csdn.net/jiaweilovemingming/article/details/124067428?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-124067428-blog-122730065.pc_relevant_antiscanv2&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-1-124067428-blog-122730065.pc_relevant_antiscanv2&amp;utm_relevant_index=2\"> 将 hexo 部署到云服务器</a></p>\n","categories":[],"tags":[{"name":"hexo","slug":"hexo","count":1,"path":"api/tags/hexo.json"}]}